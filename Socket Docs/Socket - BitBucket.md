## How to Guide: Using Socket in Your Bitbucket Pipeline

### Introduction

Integrating Socket into your Bitbucket Pipeline enhances your CI/CD workflow by adding security checks for vulnerabilities and risks associated with third-party dependencies. This guide provides step-by-step instructions on setting up and using Socket in your Bitbucket Pipeline.

### Prerequisites

Before you begin, ensure you have the following:
- A Socket account with API access.
- A Bitbucket repository.
- Administrator permissions to configure pipelines and manage environment variables.
- Node.js and npm installed on your local machine.

### Step 1: Setting Up Socket

**1.1 Sign Up and Log In**
- Visit the [Socket website](https://docs.socket.dev/docs/getting-started) and sign up for an account.
- Log in to your account to access the Socket dashboard.

**1.2 Install Socket CLI**
- Open your terminal and run the following command to install the Socket CLI globally:
  ```bash
  npm install -g @socketsecurity/cli
  ```

### Step 2: Configuring Your Bitbucket Pipeline

**2.1 Create or Update `bitbucket-pipelines.yml`**
- Navigate to your Bitbucket repository.
- Create or edit the `bitbucket-pipelines.yml` file in the root directory of your repository.

**2.2 Add Socket Security Scan Step**
- Add a new step to run the Socket security scan. Below is an example configuration:

```yaml
pipelines:
  default:
    - step:
        name: Security Scan
        caches:
          - node
        script:
          - npm install -g @socketsecurity/cli
          - socket scan
        services:
          - docker
        artifacts:
          - path/to/your/artifacts # Optional: specify if you want to keep any artifacts
```

**2.3 Secure Environment Variables**
- Go to **Repository settings > Pipelines > Repository variables**.
- Add a new variable `SOCKET_API_KEY` and set its value to your Socket API key.

### Step 3: Running the Pipeline

**3.1 Commit and Push Changes**
- Commit your changes to `bitbucket-pipelines.yml` and push them to your Bitbucket repository.

```bash
git add bitbucket-pipelines.yml
git commit -m "Add Socket security scan to pipeline"
git push origin main
```

**3.2 Monitor Pipeline Execution**
- Navigate to the **Pipelines** section in Bitbucket.
- Monitor the execution of the pipeline. The Socket security scan will run as part of the pipeline, checking for vulnerabilities and risks.

### Step 4: Reviewing Results

**4.1 View Pipeline Logs**
- Once the pipeline has run, click on the pipeline run to view the detailed logs.
- Look for the output of the `socket scan` command to see the results of the security scan.

**4.2 Addressing Issues**
- If vulnerabilities or risks are detected, review the detailed report provided by Socket.
- Take necessary actions to address the identified issues, such as updating dependencies or removing risky packages.

### Best Practices

1. **Run Security Scans Regularly**: Integrate Socket scans in your pipeline to run on every push or pull request to catch vulnerabilities early.
2. **Fail on High Severity Issues**: Configure your pipeline to fail if high severity vulnerabilities are detected, preventing insecure code from being merged or deployed.
3. **Keep Dependencies Updated**: Regularly update your dependencies to ensure you are using the latest secure versions.
4. **Review Reports**: Regularly review the security reports generated by Socket to stay informed about potential risks.

### Example Bitbucket Pipeline Configuration

Hereâ€™s a complete example of a `bitbucket-pipelines.yml` file integrating Socket:

```yaml
image: node:14

pipelines:
  default:
    - step:
        name: Install Dependencies
        caches:
          - node
        script:
          - npm install
    - step:
        name: Run Tests
        script:
          - npm test
    - step:
        name: Security Scan
        caches:
          - node
        script:
          - npm install -g @socketsecurity/cli
          - socket scan
        services:
          - docker
```

### Troubleshooting

- **No Data in Pipeline Logs**: Ensure the environment variable `SOCKET_API_KEY` is set correctly in the Bitbucket repository settings.
- **Authentication Issues**: Verify that the API key is valid and has the necessary permissions.
- **Data Format Issues**: Check the output format of the `socket scan` command to ensure it matches the expected format.

By following this guide, you can effectively integrate Socket into your Bitbucket Pipeline, enhancing your CI/CD workflow with robust security checks for third-party dependencies.
